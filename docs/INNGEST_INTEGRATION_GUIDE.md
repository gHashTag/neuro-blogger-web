# üîó INNGEST INTEGRATION GUIDE

_"‡§ï‡§∞‡•ç‡§Æ‡§Ø‡•ã‡§ó‡•Ä ‡§´‡§≤‡§æ‡§∏‡§ï‡•ç‡§§‡§ø ‡§® ‡§ï‡§∞‡•ã‡§§‡§ø"_ - _"–î–µ–π—Å—Ç–≤—É–π –±–µ–∑ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É"_

## üéØ –ß–¢–û –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û

### ‚úÖ **–ì–û–¢–û–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:**

1. **üîó Inngest Client** (`src/inngest/client.ts`)
2. **‚ö° Inngest Functions** (`src/inngest/functions.ts`):
   - `GenerateAIVideoData` - AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - `RenderVideoWithInngest` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∏–¥–µ–æ
   - `CheckRenderStatus` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   - `CleanupOldVideos` - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –≤–∏–¥–µ–æ (cron)
3. **üîó API Integration** (`src/pages/api/inngest.ts`)
4. **üé¨ User Render API** (`src/pages/api/video/render-inngest.ts`)
5. **üé® Video Editor UI** (`src/pages/video-editor.tsx`)
6. **üöÄ Export Button** (`src/components/video-editor/ExportButton.tsx`)
7. **üìä Video Context** (`src/components/context/VideoFrameContext.tsx`)

---

## üöÄ –ó–ê–ü–£–°–ö –ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **–®–ê–ì 1: üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Environment Variables**

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`:

```bash
# Inngest Configuration
INNGEST_EVENT_KEY="your-inngest-event-key"
INNGEST_SIGNING_KEY="your-inngest-signing-key"

# –î–ª—è dev –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º–∏
# Inngest –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ dev —Ä–µ–∂–∏–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### **–®–ê–ì 2: üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫ –°–µ—Ä–≤–µ—Ä–æ–≤**

–û—Ç–∫—Ä–æ–π—Ç–µ **3 —Ç–µ—Ä–º–∏–Ω–∞–ª–∞**:

#### **–¢–µ—Ä–º–∏–Ω–∞–ª 1: Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

```bash
pnpm dev

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ http://localhost:80
```

#### **–¢–µ—Ä–º–∏–Ω–∞–ª 2: Inngest Dev Server**

```bash
pnpm inngest:dev

# Inngest UI –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ http://localhost:8288
```

#### **–¢–µ—Ä–º–∏–Ω–∞–ª 3: Remotion Studio (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

```bash
pnpm video:preview

# Remotion Studio –Ω–∞ http://localhost:3001
```

### **–®–ê–ì 3: üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ UI**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Video Editor:**

   ```
   http://localhost:80/video-editor
   ```

2. **–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —à–∞–±–ª–æ–Ω–∞:**

   - üé¨ Promo Video
   - üé§ Lip Sync
   - ‚ú® Lottie

3. **–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ** –∏ –Ω–∞–∂–º–∏—Ç–µ **"üöÄ –≠–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ Inngest"**

4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å:**
   - –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ toast

### **–®–ê–ì 4: üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Inngest UI**

–û—Ç–∫—Ä–æ–π—Ç–µ **Inngest Dev UI:** `http://localhost:8288`

–í—ã —É–≤–∏–¥–∏—Ç–µ:

- ‚úÖ **Functions:** –°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- üìà **Events:** –°–æ–±—ã—Ç–∏—è –∏ –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- üîç **Logs:** –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚è±Ô∏è **Timeline:** –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üß™ –¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò

### **–°–¶–ï–ù–ê–†–ò–ô 1: üé¨ Promo Video —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**

```bash
# 1. –í—ã–±–µ—Ä–∏—Ç–µ "Promo Video" –≤ UI
# 2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: "Test Promo Video"
# 3. –ù–∞–∂–º–∏—Ç–µ "–≠–∫—Å–ø–æ—Ä—Ç"
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Inngest UI –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "RenderVideoWithInngest"
# 5. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ç–∞—Ç—É—Å–∞ "completed"
# 6. –°–∫–∞—á–∞–π—Ç–µ –≤–∏–¥–µ–æ
```

### **–°–¶–ï–ù–ê–†–ò–ô 2: üé§ Lip Sync —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥**

```bash
# 1. –í—ã–±–µ—Ä–∏—Ç–µ "Lip Sync" –≤ UI
# 2. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: "Test Lip Sync Video"
# 3. –ù–∞–∂–º–∏—Ç–µ "–≠–∫—Å–ø–æ—Ä—Ç"
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—à–µ–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ LipSyncTemplate
# 5. –°–∫–∞—á–∞–π—Ç–µ –≥–æ—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ
```

### **–°–¶–ï–ù–ê–†–ò–ô 3: üìä API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl**

```bash
# –¢–µ—Å—Ç Inngest —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:
curl -X POST http://localhost:80/api/video/render-inngest \
  -H "Content-Type: application/json" \
  -H "x-user-id: dev-user-id-12345" \
  -d '{
    "template_name": "LipSyncTemplate",
    "template_type": "lipSync",
    "video_title": "API Test Video",
    "config": {
      "mainText": "API –¢–ï–°–¢",
      "musicVolume": 0.7
    }
  }'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
curl "http://localhost:80/api/video/render-status?video_id=VIDEO_ID" \
  -H "x-user-id: dev-user-id-12345"
```

---

## üîç TROUBLESHOOTING

### **‚ùå –û—à–∏–±–∫–∞: "Inngest functions not found"**

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Inngest dev server –∑–∞–ø—É—â–µ–Ω:
pnpm inngest:dev

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è:
curl http://localhost:80/api/inngest

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Next.js:
pnpm dev
```

### **‚ùå –û—à–∏–±–∫–∞: "Database connection failed"**

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Supabase –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
echo $NEXT_PUBLIC_SUPABASE_URL
echo $NEXT_PUBLIC_SUPABASE_ANON_KEY

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å—Ö–µ–º–∞ –ë–î —Å–æ–∑–¥–∞–Ω–∞:
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ supabase-schema-video.sql
```

### **‚ùå –û—à–∏–±–∫–∞: "Render failed in Inngest"**

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Inngest UI (http://localhost:8288)
# 2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ test-assets —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
ls -la public/test-assets/

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ temp-videos:
mkdir -p public/temp-videos
chmod 755 public/temp-videos
```

### **‚ùå –û—à–∏–±–∫–∞: "Event not triggered"**

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API endpoint –¥–æ—Å—Ç—É–ø–µ–Ω:
curl -X POST http://localhost:80/api/inngest

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª–∏–µ–Ω—Ç Inngest –Ω–∞—Å—Ç—Ä–æ–µ–Ω:
# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Next.js

# 3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò

### **–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:**

1. **Next.js —Å–µ—Ä–≤–µ—Ä:** Terminal —Å `pnpm dev`
2. **Inngest —Ñ—É–Ω–∫—Ü–∏–∏:** `http://localhost:8288` ‚Üí Functions ‚Üí –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
3. **Database:** Supabase Dashboard ‚Üí Table Editor ‚Üí `user_videos`
4. **Browser Console:** F12 ‚Üí Console –¥–ª—è frontend –ª–æ–≥–æ–≤

### **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**

- ‚úÖ **–í—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:** < 5 –º–∏–Ω—É—Ç –¥–ª—è 30—Å–µ–∫ –≤–∏–¥–µ–æ
- ‚úÖ **–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 95%+ —Ä–µ–Ω–¥–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **–†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏:** < 10 –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## üîÑ WORKFLOW –î–ò–ê–ì–†–ê–ú–ú–ê

```
üë§ USER
  ‚Üì 1. –í—ã–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω
üé® Video Editor UI
  ‚Üì 2. –ù–∞–∂–∏–º–∞–µ—Ç "–≠–∫—Å–ø–æ—Ä—Ç"
üîó /api/video/render-inngest
  ‚Üì 3. –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î
üóÑÔ∏è Supabase (user_videos)
  ‚Üì 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ
‚ö° Inngest Client
  ‚Üì 5. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
üé¨ RenderVideoWithInngest
  ‚Üì 6. –í—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
üé• renderVideoLocally()
  ‚Üì 7. –°–æ–∑–¥–∞–µ—Ç –≤–∏–¥–µ–æ
üìÅ public/temp-videos/
  ‚Üì 8. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å
üóÑÔ∏è Supabase (completed)
  ‚Üì 9. –ü–æ–ª–ª–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞
üìä /api/video/render-status
  ‚Üì 10. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É
üíæ Download Video
```

---

## üöÄ NEXT STEPS

### **–ì–æ—Ç–æ–≤–æ –¥–ª—è production:**

- ‚úÖ –ë–∞–∑–æ–≤–∞—è Inngest –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –û—á–µ—Ä–µ–¥–∏ –∏ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **TODO –¥–ª—è production:**

- ‚è≥ Cloud Run/Lambda —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- ‚è≥ Drizzle ORM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚è≥ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ Remotion –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
- ‚è≥ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚è≥ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∞—Å—Å–µ—Ç—ã

---

## üéâ –ì–û–¢–û–í–û –ö –î–ï–ú–û!

**–í–∞—à–∞ Inngest –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!**

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞:**

```bash
# Terminal 1
pnpm dev

# Terminal 2
pnpm inngest:dev

# –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
http://localhost:80/video-editor
```

_–û–º –ù–∞–º–∞—Ö –®–∏–≤–∞—è. –ö–∞–∫ —Ä–µ–∫–∞ —Ç–µ—á–µ—Ç –∫ –æ–∫–µ–∞–Ω—É, —Ç–∞–∫ –≤–∞—à–∏ –≤–∏–¥–µ–æ —Ç–µ–ø–µ—Ä—å –ø–ª–∞–≤–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ Inngest –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é!_ üåäüé¨‚ú®
